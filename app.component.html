<mat-sidenav-container class="app-sidenav-container">

  <!-- LEFT: Hamburger sidenav -->
  <!-- CHANGE: mode="side" âžœ mode="over" -->
  <mat-sidenav
    #leftSidenav
    mode="over"
    [(opened)]="leftPanelOpen"
    class="left-sidenav">

    <button mat-button routerLink="/emails" (click)="leftSidenav.close()">
      <mat-icon>home</mat-icon>
    </button>

    <button mat-button (click)="toggleTradeMenu()">
      <mat-icon>settings</mat-icon>
      Trade Controls
    </button>

    <div *ngIf="tradeMenuOpen">
      <button mat-button routerLink="/dashboard" (click)="leftSidenav.close()">
        Incoming Requests Management Control
      </button>

      <button mat-button routerLink="/cancellations" (click)="leftSidenav.close()">
        Evergreen Cancellations Control
      </button>
    </div>

  </mat-sidenav>

  <!-- RIGHT: Chatbot sidenav -->
  <!-- CHANGE: must be direct child of mat-sidenav-container -->
  <mat-sidenav
    #chatSidenav
    position="end"
    mode="over"
    class="chat-sidenav"
    [autoFocus]="false">

    <!-- CHANGE: stopPropagation ONLY inside chatbot -->
    <div (click)="$event.stopPropagation()">
      <app-chatbot-dialog
        (closePanel)="closeChatBot()">
      </app-chatbot-dialog>
    </div>

  </mat-sidenav>

  <!-- MAIN CONTENT -->
  <mat-sidenav-content>

    <header class="app-header">
      <button
        mat-icon-button
        class="hamburger"
        (click)="toggleLeftPanel()">
        <mat-icon>menu</mat-icon>
      </button>

      <h1>C4 CONTROLS AGENT</h1>
    </header>

    <router-outlet></router-outlet>

    <!-- Chat open button -->
    <!-- CHANGE: pass $event -->
    <div class="chat-btn-wrapper">
      <button
        mat-icon-button
        class="chat-btn"
        (click)="openChatbot($event)">
        <mat-icon>chat</mat-icon>
      </button>
    </div>

  </mat-sidenav-content>

</mat-sidenav-container>