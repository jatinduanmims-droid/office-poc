<div class="dashboard-v2">

  <!-- KPI STRIP -->
  <div class="kpi-strip">
    <div class="kpi-card">
      <div class="value">{{ kpiData.success + kpiData.failure }}</div>
      <div class="label">Total Controls</div>
    </div>

    <div class="kpi-card success">
      <div class="value">{{ kpiData.success }}</div>
      <div class="label">Successful</div>
    </div>

    <div class="kpi-card danger">
      <div class="value">{{ kpiData.failure }}</div>
      <div class="label">Unsuccessful</div>
    </div>

    <div class="kpi-card success">
      <div class="value">{{ slaMetPercent }}%</div>
      <div class="label">SLA Met</div>
    </div>

    <div class="kpi-card danger">
      <div class="value">{{ slaBreachPercent }}%</div>
      <div class="label">SLA Breach</div>
    </div>
  </div>

  <!-- MIDDLE SECTION -->
  <div class="mid-grid">

    <!-- CONTROLS PERFORMANCE -->
    <div class="card">
      <div class="card-header">
        ‚≠ê Controls Performance
      </div>

      <div class="control-row clickable" (click)="onDomainSelect('TRADE')">
        <div class="label">Trade Controls</div>
        <div class="bar">
          <div class="bar-success"
               [style.width.%]="(tradeSuccessCount / (tradeSuccessCount + tradeFailureCount)) * 100">
          </div>
          <div class="bar-failure"
               [style.width.%]="(tradeFailureCount / (tradeSuccessCount + tradeFailureCount)) * 100">
          </div>
        </div>
        <div class="count">{{ tradeSuccessCount }} / {{ tradeFailureCount }}</div>
      </div>

      <div class="control-row clickable" (click)="onDomainSelect('LOAN')">
        <div class="label">Loan Controls</div>
        <div class="bar">
          <div class="bar-success"
               [style.width.%]="(loanSuccessCount / (loanSuccessCount + loanFailureCount)) * 100">
          </div>
          <div class="bar-failure"
               [style.width.%]="(loanFailureCount / (loanSuccessCount + loanFailureCount)) * 100">
          </div>
        </div>
        <div class="count">{{ loanSuccessCount }} / {{ loanFailureCount }}</div>
      </div>

      <div class="control-row clickable" (click)="onDomainSelect('SUPPLY')">
        <div class="label">Supply Chain Controls</div>
        <div class="bar">
          <div class="bar-success"
               [style.width.%]="(supplySuccessCount / (supplySuccessCount + supplyFailureCount)) * 100">
          </div>
          <div class="bar-failure"
               [style.width.%]="(supplyFailureCount / (supplySuccessCount + supplyFailureCount)) * 100">
          </div>
        </div>
        <div class="count">{{ supplySuccessCount }} / {{ supplyFailureCount }}</div>
      </div>
    </div>

    <!-- FAILED CONTROLS -->
    <div class="card failed">
      <div class="card-header">
        Failed Controls (Today)
        <span class="badge">{{ failedControlsToday.length }}</span>
      </div>

      <ul>
        <li *ngFor="let ctrl of failedControlsToday">
          ‚ö† {{ ctrl }}
        </li>
      </ul>
    </div>

  </div>

  <!-- SLA TREND -->
  <div class="card">
    <div class="card-header with-select">
      <span>üìà SLA Trend for {{ selectedControl?.name }}</span>

      <mat-select
        class="control-select"
        [value]="selectedControl"
        (selectionChange)="onSelectControl($event.value)">
        <mat-option *ngFor="let ctrl of controls" [value]="ctrl">
          {{ ctrl.name }}
        </mat-option>
      </mat-select>
    </div>

    <canvas
      baseChart
      [data]="lineChartData"
      [options]="lineChartOptions"
      [type]="'line'">
    </canvas>
  </div>

</div>