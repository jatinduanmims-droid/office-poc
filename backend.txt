




- 



Add a new FastAPI endpoint:

GET /dashboard/kpis

Rules:
- Add route in angular/api/main.py
- Use existing Oracle views (do not query base tables)
- Use utils_trans_db.py for DB execution
- Do not modify existing endpoints

Compute server-side using SQL:
- eventsToday (EMAIL_RECEIVEDTIME = today)
- requestsToday (OPERATION='Issue' AND EMAIL_RECEIVEDTIME = today)
- dueToday (SLA_DATE = today)
- dueNext5Days (SLA_DATE between today+1 and today+5)
- undefinedRequests (OPERATION IS NULL OR '')
- slaBreaches (USERSLAFETFLAG = 'N')

Also compute:
- Same KPIs for yesterday
- Same KPIs for last week

Return:
- Route code
- SQL queries
- Pydantic response schema
- Sample JSON response




Add a new FastAPI endpoint:

GET /dashboard/kpis

Rules:
- Add route in angular/api/main.py
- Use get_analyticsdb_data(query) for DB access
- Query ONLY Oracle views (do not query base tables)
- Do not modify or break existing endpoints

Compute server-side using SQL (Oracle):

- eventsToday:
  COUNT(*) where TRUNC(EMAIL_RECEIVEDTIME) = TRUNC(SYSDATE)

- requestsToday:
  COUNT(*) where OPERATION = 'Issue'
  AND TRUNC(EMAIL_RECEIVEDTIME) = TRUNC(SYSDATE)

- dueToday:
  COUNT(*) where TRUNC(SLA_DATE) = TRUNC(SYSDATE)

- dueNext5Days:
  COUNT(*) where SLA_DATE BETWEEN TRUNC(SYSDATE)+1 AND TRUNC(SYSDATE)+5

- undefinedRequests:
  COUNT(*) where OPERATION IS NULL OR OPERATION = ''

- slaBreaches:
  COUNT(*) where USERSLAFETFLAG = 'N'

Also compute the same KPIs for:
- yesterday
- last week

Return:
- FastAPI route code
- Oracle SQL queries
- Pydantic response schema (KPIsResponse)
- Add a new FastAPI endpoint:

GET /dashboard/trends

Rules:
- Add route in angular/api/main.py
- Use get_analyticsdb_data(query)
- Query ONLY Oracle views
- Do not return raw rows

Requirements:
- Aggregate by date
- Support groupBy: daily | weekly | monthly
- Support rangeDays (default 30, max 365)

Return:
- Route code
- Oracle SQL
- Pydantic response schema
- Sample JSON response



step3
Add a new FastAPI endpoint:

GET /dashboard/table

Rules:
- Add route in angular/api/main.py
- Use get_analyticsdb_data(query) for DB access
- Query ONLY Oracle views (do not query base tables)
- Do NOT modify or break existing endpoints
- Do NOT return the full dataset under any condition

Functional Requirements:

1) Pagination
- Params:
  - page (default 1)
  - pageSize (default 25, max 100)
- Use Oracle OFFSET / FETCH NEXT
- Return totalCount using a separate COUNT(*) query

2) Sorting
- Params:
  - sortField (validated against allowed column list)
  - sortDirection (ASC | DESC)
- Prevent SQL injection by whitelisting columns

3) Filtering
- Supported filters:
  - date range (EMAIL_RECEIVEDTIME from/to)
  - OPERATION
  - SERVICE
  - PRODUCT
  - USERSLAFETFLAG
- Filters must apply to BOTH:
  - data query
  - totalCount query

4) Date Handling (IMPORTANT)
- All date comparisons must use TRUNC()
- Date filters must be applied in SQL, not Python
- Never compare dates to expressions incorrectly (avoid TRUNC(date)=TRUNC(other_column))

5) SLA Logic (IMPORTANT)
- SLA breaches must always be date-bounded
- Never count historical SLA breaches unintentionally

6) Null Safety
- Use NVL() for numeric fields
- Ensure no NULL values are returned for counts or flags

SQL Requirements:
- Use SELECT only
- Avoid SELECT *
- Explicit column list
- Reuse existing Oracle views with VPD intact

Response Shape:
{
  "data": [ ... rows ... ],
  "totalCount": number,
  "page": number,
  "pageSize": number
}

Return:
- FastAPI route code
- Oracle SQL for:
  - paginated data
  - totalCount
- Pydantic response schema
- Sample JSON response




UI
step1
Create a new Angular frontend under src/app-v2.

Rules:
- Do not touch src/app (legacy)
- Copy only core/, environments/, assets/
- Create app-v2.module.ts
- Create app-v2-routing.module.ts
- Lazy load dashboard module at /dashboar


step2
Got it ‚Äî here is UI PROMPT 2, clean, concise, and ready to paste into Roo Code üëá
(no extra explanation, no redesign of Prompt 1)

‚∏ª

UI PROMPT 2 ‚Äî New Dashboard V2 UI Shell

Objective
Create a brand-new dashboard UI under src/app-v2/dashboard that will replace the legacy dashboard visually, while keeping legacy code untouched.

‚∏ª

Rules
	‚Ä¢	‚ùå Do NOT modify src/app (legacy)
	‚Ä¢	‚ùå Do NOT reuse legacy dashboard components or HTML
	‚Ä¢	‚úÖ Only reuse shared services / interceptors if needed
	‚Ä¢	‚úÖ Use Angular Material
	‚Ä¢	‚úÖ Layout only ‚Äî no API calls, no mock data
	‚Ä¢	‚úÖ Route must stay under /dashboard-v2

‚∏ª

Create Folder Structure

src/app-v2/dashboard/
‚îú‚îÄ‚îÄ dashboard.module.ts
‚îú‚îÄ‚îÄ dashboard-routing.module.ts
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ dashboard-page/
‚îÇ       ‚îú‚îÄ‚îÄ dashboard-page.component.ts
‚îÇ       ‚îú‚îÄ‚îÄ dashboard-page.component.html
‚îÇ       ‚îî‚îÄ‚îÄ dashboard-page.component.scss
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ kpi-cards/
‚îÇ   ‚îú‚îÄ‚îÄ trend-charts/
‚îÇ   ‚îî‚îÄ‚îÄ data-table/


‚∏ª

Routing
	‚Ä¢	/dashboard-v2 ‚Üí DashboardPageComponent

‚∏ª

Dashboard Layout (HTML only)

1. Header
	‚Ä¢	Title: Email Monitoring Dashboard
	‚Ä¢	Right aligned placeholder: Date Range

2. KPI Section
	‚Ä¢	6 cards in responsive grid
	‚Ä¢	Each card shows:
	‚Ä¢	KPI title
	‚Ä¢	Big number placeholder (--)
	‚Ä¢	Subtext placeholder (vs yesterday)

3. Trends Section
	‚Ä¢	Full-width card
	‚Ä¢	Text: Trend Chart (Daily / Weekly / Monthly)

4. Table Section
	‚Ä¢	Full-width card
	‚Ä¢	Text: Requests Table

‚∏ª

Styling Guidelines
	‚Ä¢	Card-based layout
	‚Ä¢	Light background (#f5f7fa)
	‚Ä¢	Use spacing: 8 / 16 / 24 px
	‚Ä¢	CSS Grid / Flexbox
	‚Ä¢	No KPI colors yet

‚∏ª

Component Rules
	‚Ä¢	Components must compile
	‚Ä¢	Empty ngOnInit()
	‚Ä¢	No logic
	‚Ä¢	No API calls
	‚Ä¢	No chart libraries yet

‚∏ª

Deliverables
	‚Ä¢	/dashboard-v2 loads successfully
	‚Ä¢	Clean modern layout visible
	‚Ä¢	No console errors
	‚Ä¢	Legacy UI untouched

‚∏ª

Non-Goals
	‚Ä¢	‚ùå No backend changes
	‚Ä¢	‚ùå No data binding
	‚Ä¢	‚ùå No charts
	‚Ä¢	‚ùå No table logic

‚∏ª

When this is done, next steps will be:
	‚Ä¢	UI Prompt 3 ‚Üí KPI Cards (API wiring)
	‚Ä¢	UI Prompt 4 ‚Üí Trend Charts
	‚Ä¢	UI Prompt 5 ‚Üí Paginated Table UI

Say ‚ÄúGive UI Prompt 3‚Äù when ready.







